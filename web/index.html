<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº”ç”¨å•†åº— - XMLè§£æå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .url-input-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .url-input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .url-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .sample-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            margin-left: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 18px;
        }

        .spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #ff6b6b;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .stats {
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stats-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .stat-value {
            font-weight: 600;
            color: #333;
            font-size: 18px;
        }

        .apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .app-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            animation: fadeInUp 0.5s ease forwards;
            opacity: 0;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .app-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .app-header {
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .app-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            object-fit: cover;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .app-info {
            flex: 1;
        }

        .app-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .app-version {
            font-size: 14px;
            color: #666;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .version-badge {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .app-body {
            padding: 20px;
        }

        .app-description {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .app-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
        }

        .meta-label {
            font-size: 12px;
            color: #999;
            margin-bottom: 2px;
        }

        .meta-value {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        .platforms {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .platforms-title {
            font-size: 12px;
            color: #999;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .platform-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .platform-tag {
            background: #f8f9fa;
            color: #495057;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            border: 1px solid #dee2e6;
        }

        .download-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: white;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .empty-title {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .empty-description {
            font-size: 16px;
            opacity: 0.9;
        }

        /* åˆ†é¡µæ ·å¼ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .pagination-btn {
            padding: 8px 16px;
            background: white;
            color: #667eea;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
            border-color: #667eea;
            transform: translateY(-1px);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .page-info {
            color: white;
            font-size: 14px;
            margin: 0 10px;
        }

        /* æœç´¢æ ·å¼ */
        .search-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-info {
            text-align: center;
            color: white;
            margin: 15px 0;
            font-size: 14px;
        }

        .clear-search-btn {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            background: #f0f0f0;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #666;
        }

        .clear-search-btn:hover {
            background: #e0e0e0;
        }

        .search-container {
            position: relative;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .apps-grid {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .sample-btn {
                margin-left: 0;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“¦ åº”ç”¨å•†åº—</h1>
            <p>è¾“å…¥XMLç½‘å€ï¼Œè§£æå¹¶å±•ç¤ºåº”ç”¨ä¿¡æ¯</p>
        </div>

        <div class="url-input-section">
            <div class="input-group">
                <input type="url" 
                       id="xmlUrl" 
                       class="url-input" 
                       placeholder="è¯·è¾“å…¥XMLæ–‡ä»¶ç½‘å€ï¼Œä¾‹å¦‚ï¼šhttps://example.com/plugins.xml">
                <button id="parseBtn" class="btn">è§£æXML</button>
                <button id="sampleBtn" class="btn sample-btn">åŠ è½½ç¤ºä¾‹</button>
            </div>
            <div style="color: #666; font-size: 14px;">
                ğŸ’¡ æç¤ºï¼šè¯·ç¡®ä¿XMLæ–‡ä»¶æ”¯æŒè·¨åŸŸè®¿é—®ï¼ˆé…ç½®äº†æ­£ç¡®çš„CORSå¤´ï¼‰ï¼Œæˆ–åœ¨æœ¬åœ°æœåŠ¡å™¨ç¯å¢ƒä¸‹ä½¿ç”¨
            </div>
        </div>

        <div id="errorMessage" class="error-message"></div>
        
        <div id="stats" class="stats">
            <div class="stats-content">
                <div class="stat-item">
                    <span class="stat-label">åº”ç”¨æ€»æ•°ï¼š</span>
                    <span id="totalCount" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">åˆ†ç±»ï¼š</span>
                    <span id="categories" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">æœ€åæ›´æ–°ï¼š</span>
                    <span id="lastUpdate" class="stat-value">-</span>
                </div>
            </div>
        </div>

        <div id="searchSection" class="search-section" style="display: none;">
            <div class="search-container">
                <input type="text" 
                       id="searchInput" 
                       class="search-input" 
                       placeholder="æœç´¢åº”ç”¨åç§°ã€æè¿°ã€å¼€å‘è€…...">
                <button id="clearSearchBtn" class="clear-search-btn" style="display: none;">Ã—</button>
            </div>
        </div>

        <div id="searchInfo" class="search-info" style="display: none;">
            æ­£åœ¨æ˜¾ç¤ºä¸ "<span id="searchKeyword"></span>" ç›¸å…³çš„ <span id="searchCount"></span> ä¸ªç»“æœ
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            æ­£åœ¨è§£æXMLæ–‡ä»¶...
        </div>

        <div id="pagination" class="pagination" style="display: none;">
            <button id="prevPage" class="pagination-btn" disabled>ä¸Šä¸€é¡µ</button>
            <span class="page-info">ç¬¬ <span id="currentPage">1</span> é¡µï¼Œå…± <span id="totalPages">1</span> é¡µ</span>
            <div id="pageButtons" class="page-buttons"></div>
            <button id="nextPage" class="pagination-btn" disabled>ä¸‹ä¸€é¡µ</button>
        </div>

        <div id="emptyState" class="empty-state">
            <div class="empty-icon">ğŸ“‹</div>
            <div class="empty-title">æš‚æ— åº”ç”¨æ•°æ®</div>
            <div class="empty-description">è¯·è¾“å…¥XMLç½‘å€æˆ–ç‚¹å‡»"åŠ è½½ç¤ºä¾‹"æŒ‰é’®</div>
        </div>

        <div id="appsGrid" class="apps-grid" style="display: none;"></div>
    </div>

    <script>
        // ç¤ºä¾‹XMLæ•°æ®
        const sampleXML = `<?xml version='1.0' encoding='utf-8'?>
<plugins>
  <cachechk>202511021353</cachechk>
  <item>
    <name>iPerf3</name>
    <changeLog></changeLog>
    <category>QnapclubCN Repo</category>
    <type>å…¶ä»–</type>
    <icon80>https://help.qnapclub.cn/upload/logo_80x80.png</icon80>
    <icon100>https://help.qnapclub.cn/upload/logo_100x100.png</icon100>
    <description>ç½‘ç»œæ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œç”¨äºæµ‹é‡ç½‘ç»œå¸¦å®½å’Œè´¨é‡</description>
    <fwVersion>4.2.6</fwVersion>
    <version>3.19.1</version>
    <platform>
      <platformID>TS-NASX86</platformID>
      <location>https://www.myqnap.org/repo/iPerf3_3.19.1_x86_64.qpkg</location>
      <signature></signature>
    </platform>
    <platform>
      <platformID>TS-NASARM_64</platformID>
      <location>https://www.myqnap.org/repo/iPerf3_3.19.1_arm_64.qpkg</location>
      <signature></signature>
    </platform>
    <internalName>iPerf3</internalName>
    <publishedDate>2025-10-19 14:21</publishedDate>
    <maintainer>QoolBox</maintainer>
    <developer>QoolBox</developer>
    <forumLink></forumLink>
    <language>English</language>
    <snapshot></snapshot>
    <bannerImg></bannerImg>
    <tutorialLink></tutorialLink>
  </item>
  <item>
    <name>Docker</name>
    <changeLog>æ›´æ–°Dockerå¼•æ“åˆ°æœ€æ–°ç‰ˆæœ¬</changeLog>
    <category>QnapclubCN Repo</category>
    <type>è™šæ‹ŸåŒ–</type>
    <icon80>https://help.qnapclub.cn/upload/docker_80x80.png</icon80>
    <icon100>https://help.qnapclub.cn/upload/docker_100x100.png</icon100>
    <description>å®¹å™¨åŒ–å¹³å°ï¼Œè½»æ¾éƒ¨ç½²å’Œç®¡ç†åº”ç”¨ç¨‹åº</description>
    <fwVersion>4.3.6</fwVersion>
    <version>24.0.7</version>
    <platform>
      <platformID>TS-NASX86</platformID>
      <location>https://www.myqnap.org/repo/Docker_24.0.7_x86_64.qpkg</location>
      <signature></signature>
    </platform>
    <platform>
      <platformID>TS-NASARM_64</platformID>
      <location>https://www.myqnap.org/repo/Docker_24.0.7_arm_64.qpkg</location>
      <signature></signature>
    </platform>
    <internalName>ContainerStation</internalName>
    <publishedDate>2025-11-01 09:15</publishedDate>
    <maintainer>QNAP</maintainer>
    <developer>Docker Inc</developer>
    <forumLink>https://forum.qnap.com</forumLink>
    <language>English</language>
    <snapshot></snapshot>
    <bannerImg></bannerImg>
    <tutorialLink>https://docs.qnap.com</tutorialLink>
  </item>
  <item>
    <name>FileStation</name>
    <changeLog>ä¿®å¤æ–‡ä»¶ä¸Šä¼ é—®é¢˜</changeLog>
    <category>QnapclubCN Repo</category>
    <type>æ–‡ä»¶ç®¡ç†</type>
    <icon80>https://help.qnapclub.cn/upload/filestation_80x80.png</icon80>
    <icon100>https://help.qnapclub.cn/upload/filestation_100x100.png</icon100>
    <description>å¼ºå¤§çš„æ–‡ä»¶ç®¡ç†å·¥å…·ï¼Œæ”¯æŒè¿œç¨‹è®¿é—®å’Œåˆ†äº«</description>
    <fwVersion>4.4.0</fwVersion>
    <version>5.2.1</version>
    <platform>
      <platformID>TS-NASX86</platformID>
      <location>https://www.myqnap.org/repo/FileStation_5.2.1_x86_64.qpkg</location>
      <signature></signature>
    </platform>
    <platform>
      <platformID>TS-NASARM_64</platformID>
      <location>https://www.myqnap.org/repo/FileStation_5.2.1_arm_64.qpkg</location>
      <signature></signature>
    </platform>
    <internalName>FileStation</internalName>
    <publishedDate>2025-10-28 16:30</publishedDate>
    <maintainer>QNAP</maintainer>
    <developer>QNAP</developer>
    <forumLink></forumLink>
    <language>ç®€ä½“ä¸­æ–‡</language>
    <snapshot></snapshot>
    <bannerImg></bannerImg>
    <tutorialLink></tutorialLink>
  </item>
</plugins>`;

        // DOMå…ƒç´ 
        const xmlUrlInput = document.getElementById('xmlUrl');
        const parseBtn = document.getElementById('parseBtn');
        const sampleBtn = document.getElementById('sampleBtn');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');
        const appsGrid = document.getElementById('appsGrid');
        const emptyState = document.getElementById('emptyState');
        const stats = document.getElementById('stats');
        const pagination = document.getElementById('pagination');
        const prevPageBtn = document.getElementById('prevPage');
        const nextPageBtn = document.getElementById('nextPage');
        const currentPageEl = document.getElementById('currentPage');
        const totalPagesEl = document.getElementById('totalPages');
        const pageButtons = document.getElementById('pageButtons');
        const searchSection = document.getElementById('searchSection');
        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearchBtn');
        const searchInfo = document.getElementById('searchInfo');
        const searchKeyword = document.getElementById('searchKeyword');
        const searchCount = document.getElementById('searchCount');

        // åˆ†é¡µå’Œæœç´¢å˜é‡
        let allItems = [];
        let filteredItems = [];
        let currentPage = 1;
        const itemsPerPage = 20;

        // è§£æXMLå¹¶åˆ›å»ºåº”ç”¨å¡ç‰‡
        function parseAndDisplayApps(xmlString) {
            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlString, 'text/xml');
                
                // æ£€æŸ¥è§£æé”™è¯¯
                if (xmlDoc.getElementsByTagName('parsererror').length > 0) {
                    throw new Error('XMLè§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥XMLæ ¼å¼');
                }

                const items = xmlDoc.getElementsByTagName('item');
                const cachechk = xmlDoc.getElementsByTagName('cachechk')[0]?.textContent || '';
                
                if (items.length === 0) {
                    showError('XMLä¸­æ²¡æœ‰æ‰¾åˆ°åº”ç”¨æ•°æ®');
                    pagination.style.display = 'none';
                    searchSection.style.display = 'none';
                    searchInfo.style.display = 'none';
                    return;
                }

                // ä¿å­˜æ‰€æœ‰é¡¹ç›®
                allItems = Array.from(items);
                filteredItems = [...allItems]; // åˆå§‹æ—¶æ˜¾ç¤ºæ‰€æœ‰é¡¹ç›®
                currentPage = 1;

                // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
                displayStats(items, cachechk);
                
                // æ˜¾ç¤ºæœç´¢æ¡†
                searchSection.style.display = 'block';
                searchInfo.style.display = 'none';
                searchInput.value = '';
                clearSearchBtn.style.display = 'none';
                
                // åˆå§‹åŒ–åˆ†é¡µ
                renderPagination();

                // æ˜¾ç¤ºç»“æœ
                emptyState.style.display = 'none';
                appsGrid.style.display = 'grid';
                hideError();

            } catch (error) {
                showError('è§£æå¤±è´¥ï¼š' + error.message);
                pagination.style.display = 'none';
                searchSection.style.display = 'none';
                searchInfo.style.display = 'none';
            }
        }

        // æ‰§è¡Œæœç´¢
        function performSearch(keyword) {
            if (!keyword.trim()) {
                filteredItems = [...allItems];
                searchInfo.style.display = 'none';
                clearSearchBtn.style.display = 'none';
            } else {
                const lowerKeyword = keyword.toLowerCase();
                filteredItems = allItems.filter(item => {
                    const name = getElementText(item, 'name').toLowerCase();
                    const description = getElementText(item, 'description').toLowerCase();
                    const developer = getElementText(item, 'developer').toLowerCase();
                    const category = getElementText(item, 'category').toLowerCase();
                    const type = getElementText(item, 'type').toLowerCase();
                    
                    return name.includes(lowerKeyword) ||
                           description.includes(lowerKeyword) ||
                           developer.includes(lowerKeyword) ||
                           category.includes(lowerKeyword) ||
                           type.includes(lowerKeyword);
                });
                
                // æ˜¾ç¤ºæœç´¢ç»“æœä¿¡æ¯
                searchKeyword.textContent = keyword;
                searchCount.textContent = filteredItems.length;
                searchInfo.style.display = 'block';
                clearSearchBtn.style.display = 'block';
            }
            
            currentPage = 1;
            renderPagination();
        }

        // æ¸²æŸ“å½“å‰é¡µ
        function renderCurrentPage() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentItems = filteredItems.slice(startIndex, endIndex);
            
            // æ¸…ç©ºç°æœ‰å†…å®¹
            appsGrid.innerHTML = '';
            
            // åˆ›å»ºå½“å‰é¡µçš„åº”ç”¨å¡ç‰‡
            currentItems.forEach((item, index) => {
                const card = createAppCard(item, startIndex + index);
                appsGrid.appendChild(card);
            });
        }

        // æ¸²æŸ“åˆ†é¡µæ§ä»¶
        function renderPagination() {
            const totalPages = Math.ceil(filteredItems.length / itemsPerPage);
            
            // æ›´æ–°é¡µç ä¿¡æ¯
            currentPageEl.textContent = currentPage;
            totalPagesEl.textContent = totalPages;
            
            // æ›´æ–°ä¸Šä¸€é¡µ/ä¸‹ä¸€é¡µæŒ‰é’®çŠ¶æ€
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            
            // ç”Ÿæˆé¡µç æŒ‰é’®
            pageButtons.innerHTML = '';
            
            // ç®€åŒ–çš„é¡µç æ˜¾ç¤ºé€»è¾‘
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            // è°ƒæ•´èµ·å§‹é¡µç ï¼Œç¡®ä¿æ˜¾ç¤ºè¶³å¤Ÿçš„é¡µç 
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            // æ·»åŠ é¡µç æŒ‰é’®
            for (let i = startPage; i <= endPage; i++) {
                const btn = document.createElement('button');
                btn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                btn.textContent = i;
                btn.onclick = () => {
                    currentPage = i;
                    renderCurrentPage();
                    renderPagination();
                };
                pageButtons.appendChild(btn);
            }
            
            // æ˜¾ç¤ºåˆ†é¡µæ§ä»¶
            pagination.style.display = 'flex';
            
            // æ¸²æŸ“å½“å‰é¡µ
            renderCurrentPage();
        }

        // ä¸Šä¸€é¡µ
        prevPageBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderCurrentPage();
                renderPagination();
            }
        });

        // ä¸‹ä¸€é¡µ
        nextPageBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(filteredItems.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderCurrentPage();
                renderPagination();
            }
        });

        // æœç´¢è¾“å…¥äº‹ä»¶
        searchInput.addEventListener('input', () => {
            performSearch(searchInput.value);
        });

        // æœç´¢æ¡†å›è½¦äº‹ä»¶
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
            }
        });

        // æ¸…é™¤æœç´¢
        clearSearchBtn.addEventListener('click', () => {
            searchInput.value = '';
            performSearch('');
        });

        // åˆ›å»ºåº”ç”¨å¡ç‰‡
        function createAppCard(item, index) {
            const name = getElementText(item, 'name');
            const version = getElementText(item, 'version');
            const description = getElementText(item, 'description');
            const category = getElementText(item, 'category');
            const type = getElementText(item, 'type');
            const maintainer = getElementText(item, 'maintainer');
            const developer = getElementText(item, 'developer');
            const publishedDate = getElementText(item, 'publishedDate');
            const fwVersion = getElementText(item, 'fwVersion');
            
            // è·å–å›¾æ ‡ï¼Œä¼˜å…ˆä½¿ç”¨100x100ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨80x80
            const icon100 = getElementText(item, 'icon100');
            const icon80 = getElementText(item, 'icon80');
            const icon = icon100 || icon80 || `https://picsum.photos/seed/${name}/100/100.jpg`;
            
            // è·å–å¹³å°ä¿¡æ¯
            const platforms = [];
            const platformElements = item.getElementsByTagName('platform');
            Array.from(platformElements).forEach(platform => {
                const platformID = getElementText(platform, 'platformID');
                const location = getElementText(platform, 'location');
                if (platformID && location) {
                    platforms.push({ id: platformID, url: location });
                }
            });

            const card = document.createElement('div');
            card.className = 'app-card';
            card.style.animationDelay = `${index * 0.1}s`;
            
            card.innerHTML = `
                <div class="app-header">
                    <img src="${icon}" alt="${name}" class="app-icon" onerror="this.src='https://picsum.photos/seed/default/60/60.jpg'">
                    <div class="app-info">
                        <div class="app-name">${name}</div>
                        <div class="app-version">
                            <span class="version-badge">v${version}</span>
                            <span>å›ºä»¶: ${fwVersion}</span>
                        </div>
                    </div>
                </div>
                <div class="app-body">
                    <div class="app-description">${description || 'æš‚æ— æè¿°'}</div>
                    <div class="app-meta">
                        <div class="meta-item">
                            <span class="meta-label">åˆ†ç±»</span>
                            <span class="meta-value">${category}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">ç±»å‹</span>
                            <span class="meta-value">${type}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">å¼€å‘è€…</span>
                            <span class="meta-value">${developer}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">å‘å¸ƒæ—¶é—´</span>
                            <span class="meta-value">${formatDate(publishedDate)}</span>
                        </div>
                    </div>
                    ${platforms.length > 0 ? `
                    <div class="platforms">
                        <div class="platforms-title">æ”¯æŒå¹³å°</div>
                        <div class="platform-tags">
                            ${platforms.map(p => `<span class="platform-tag">${p.id}</span>`).join('')}
                        </div>
                    </div>
                    ` : ''}
                    ${platforms.length > 0 ? `
                    <button class="download-btn" onclick="downloadApp('${name}', ${JSON.stringify(platforms).replace(/"/g, '&quot;')})">
                        ä¸‹è½½åº”ç”¨
                    </button>
                    ` : ''}
                </div>
            `;
            
            return card;
        }

        // è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
        function getElementText(parent, tagName) {
            const element = parent.getElementsByTagName(tagName)[0];
            return element ? element.textContent.trim() : '';
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateString) {
            if (!dateString) return '-';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('zh-CN');
            } catch {
                return dateString;
            }
        }

        // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
        function displayStats(items, cachechk) {
            const categories = new Set();
            Array.from(items).forEach(item => {
                const category = getElementText(item, 'category');
                if (category) categories.add(category);
            });

            document.getElementById('totalCount').textContent = items.length;
            document.getElementById('categories').textContent = categories.size;
            
            if (cachechk) {
                const formattedDate = cachechk.replace(/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/, '$1-$2-$3 $4:$5');
                document.getElementById('lastUpdate').textContent = formattedDate;
            }
            
            stats.style.display = 'block';
        }

        // ä¸‹è½½åº”ç”¨
        function downloadApp(name, platforms) {
            if (platforms.length === 1) {
                window.open(platforms[0].url, '_blank');
            } else {
                // å¦‚æœæœ‰å¤šä¸ªå¹³å°ï¼Œåˆ›å»ºé€‰æ‹©å¯¹è¯æ¡†
                const platformList = platforms.map((p, i) => `${i + 1}. ${p.id}`).join('\n');
                const choice = prompt(`è¯·é€‰æ‹©ä¸‹è½½å¹³å°ï¼š\n${platformList}\n\nè¯·è¾“å…¥åºå· (1-${platforms.length})`);
                
                if (choice && !isNaN(choice)) {
                    const index = parseInt(choice) - 1;
                    if (index >= 0 && index < platforms.length) {
                        window.open(platforms[index].url, '_blank');
                    }
                }
            }
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            loading.style.display = 'none';
            appsGrid.style.display = 'none';
            stats.style.display = 'none';
        }

        // éšè—é”™è¯¯ä¿¡æ¯
        function hideError() {
            errorMessage.style.display = 'none';
        }

        // ä»URLè·å–XML - ç›´æ¥ä»æœ¬æœºè®¿é—®
        async function fetchXML(url) {
            try {
                // ç›´æ¥ä»æœ¬æœºè®¿é—®URLï¼Œä¸ä½¿ç”¨ä»£ç†
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'cors', // ä½¿ç”¨CORSæ¨¡å¼
                    headers: {
                        'Accept': 'application/xml, text/xml'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                }
                
                const xmlText = await response.text();
                return xmlText;
            } catch (error) {
                // å¤„ç†è·¨åŸŸé”™è¯¯å’Œå…¶ä»–é”™è¯¯
                if (error.message.includes('CORS')) {
                    throw new Error('è·¨åŸŸè®¿é—®è¢«é˜»æ­¢ã€‚è¯·ç¡®ä¿XMLæ–‡ä»¶é…ç½®äº†æ­£ç¡®çš„CORSå¤´ï¼Œæˆ–ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨è®¿é—®ã€‚');
                } else if (error.message.includes('Failed to fetch')) {
                    throw new Error('æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–URLæ˜¯å¦æ­£ç¡®ã€‚');
                } else {
                    throw new Error('è·å–XMLæ–‡ä»¶å¤±è´¥: ' + error.message);
                }
            }
        }

        // è§£ææŒ‰é’®ç‚¹å‡»äº‹ä»¶
        parseBtn.addEventListener('click', async () => {
            const url = xmlUrlInput.value.trim();
            
            if (!url) {
                showError('è¯·è¾“å…¥XMLæ–‡ä»¶ç½‘å€');
                return;
            }

            // éªŒè¯URLæ ¼å¼
            try {
                new URL(url);
            } catch {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€');
                return;
            }

            loading.style.display = 'block';
            hideError();
            parseBtn.disabled = true;

            try {
                const xmlText = await fetchXML(url);
                parseAndDisplayApps(xmlText);
            } catch (error) {
                showError(error.message);
            } finally {
                loading.style.display = 'none';
                parseBtn.disabled = false;
            }
        });

        // ç¤ºä¾‹æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        sampleBtn.addEventListener('click', () => {
            xmlUrlInput.value = 'https://example.com/plugins.xml';
            parseAndDisplayApps(sampleXML);
        });

        // å›è½¦é”®è§¦å‘è§£æ
        xmlUrlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                parseBtn.click();
            }
        });

        // é¡µé¢åŠ è½½æ—¶éšè—ç½‘æ ¼
        appsGrid.style.display = 'none';
    </script>
</body>
</html>
